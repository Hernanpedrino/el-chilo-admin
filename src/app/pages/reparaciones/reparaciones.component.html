<div class="row">
    <div class="col-6 mt-4">
      <h3 class="text-center">Reparaciones y Afilados</h3>
        <div class="accordion mt-4" id="accordionExample">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  Reparaciones activas
                </button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div class="table">
                        <div class="col">
                            <table class="table table-bordered">
                                <thead>
                                  <tr>
                                    <th scope="col">Fecha recepcion</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Apellido</th>
                                    <th scope="col">Maquina-Reparacion</th>
                                    <th scope="col">Presupuesto</th>
                                    <th scope="col">Editar</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr class="table-active" *ngFor="let repair of activeRepairs; let i = index">
                                    <td>{{repair.fechaRecepcion | date}}</td>
                                    <td>{{repair.usuario.nombre | titlecase}}</td>
                                    <td>{{repair.usuario.apellido | titlecase}}</td>
                                    <td>{{repair.detalleMaquinaAfilado | titlecase}}</td>
                                    <td>{{repair.valorPresupuesto | currency}}</td>
                                    <td><button class="btn btn-primary" (click)="editar(i)"><i class="bi bi-pencil-square"></i></button></td>
                                  </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Reparaciones terminadas
                </button>
              </h2>
              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  <div class="table">
                    <div class="col">
                        <!-- TODO: Hacer componente tabla -->
                        <table class="table table-bordered">
                            <thead>
                              <tr>
                                <th scope="col">Fecha recepcion</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Apellido</th>
                                <th scope="col">Maquina-Reparacion</th>
                                <th scope="col">Presupuesto</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="table-active" *ngFor="let repair of finishedRepairs">
                                <td>{{repair.fechaRecepcion | date}}</td>
                                <td>{{repair.usuario.nombre | titlecase}}</td>
                                <td>{{repair.usuario.apellido | titlecase}}</td>
                                <td>{{repair.descripcion | titlecase}}</td>
                                <td>{{repair.presupuesto | currency}}</td>
                              </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Afilados activos
                </button>
              </h2>
              <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th scope="col">Fecha recepcion</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Apellido</th>
                        <th scope="col">Afilado</th>
                        <th scope="col">Presupuesto</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="table-active" *ngFor="let afilado of afiladosActivos">
                        <td>{{afilado.fechaRecepcion | date}}</td>
                        <td>{{afilado.usuario.nombre | titlecase}}</td>
                        <td>{{afilado.usuario.apellido | titlecase}}</td>
                        <td>{{afilado.detalleMaquinaAfilado | titlecase}}</td>
                        <td>{{afilado.valorPresupuesto | currency}}</td>
                      </tr>
                    </tbody>
                </table>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingFour">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                  Afilados entregados
                </button>
              </h2>
              <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th scope="col">Fecha recepcion</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Apellido</th>
                        <th scope="col">Afilado</th>
                        <th scope="col">Presupuesto</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="table-active" *ngFor="let afilado of afiladosTerminados">
                        <td>{{afilado.fechaRecepcion | date}}</td>
                        <td>{{afilado.usuario?.nombre | titlecase}}</td>
                        <td>{{afilado.usuario?.apellido | titlecase}}</td>
                        <td>{{afilado.descripcion | titlecase}}</td>
                        <td>{{afilado.presupuesto | currency}}</td>
                      </tr>
                    </tbody>
                </table>
                </div>
              </div>
            </div>
        </div>
    </div>
    <div class="col-6 mt-4">
        <h3 class="text-center">Registrar nueva reparacion/afilado</h3>
        <div class="row">
          <form [formGroup]="formularioReparaciones" (submit)="registrarReparacion()">
            <div class="form-group col-10">
              <label for="cliente" class="form-label mt-4">Cliente</label>
              <select class="form-select" id="cliente" formControlName="cliente">
                <option value="">Seleccione un cliente</option>
                <option *ngFor="let cliente of clientes" [value]="cliente._id">{{cliente.apellido | titlecase}} {{cliente.nombre | titlecase}}</option>
              </select>
            </div>
            <div class="form-group col-10">
              <label for="tipoReparacion" class="form-label mt-4">Tipo de reparacion</label>
              <select class="form-select" id="tipoReparacion" formControlName="tipo">
                <option>Afilado</option>
                <option>Reparacion</option>
              </select>
            </div>
            <div class="form-group col-10">
              <label for="descripcionMaquinaAfilado" class="form-label mt-4">Detalle de la Maquina/Afilado</label>
              <input type="text" class="form-control" formControlName="descripcionMaquinaAfilado">
            </div>
            <div class="form-group col-10">
              <label for="descripcionReparacion" class="form-label mt-4">Descripcion</label>
              <textarea class="form-control" id="descripcionReparacion" rows="3" formControlName="descripcionPresupuesto"></textarea>
            </div>
            <div class="form-group col-10">
              <label for="presupuesto" class="form-label mt-4">Presupuesto</label>
              <input type="text" class="form-control " id="valorPresupuesto" formControlName="valorPresupuesto">
            </div>
            <div class="d-grid col-10 mt-4">
              <button class="btn btn-lg btn-primary" type="submit" [disabled]="formularioReparaciones.invalid">Ingresar Reparacion</button>
            </div>
          </form>
        </div>
    </div>
</div>

<div class="row justify-content-start mb-4" *ngIf="edicion">
  <div class="col-8">
    <h3 class="text-center mt-4">Editar Reparacion</h3>
    <h3><strong>Cliente</strong> <h5 class="mt-1">{{nombre | titlecase}} {{apellido | titlecase}}</h5></h3>
    <h5>Fecha de recepcion {{fecha | date }}</h5>
    <form [formGroup]="formularioEdicion" (submit)="guardarActualizacion()">
      <fieldset>
        <div class="form-group">
          <div class="form-group col-8">
            <label class="col-form-label mt-4" for="inputDefault">Maquina-Repuesto</label>
            <input type="text" class="form-control" formControlName="maquinaRepuesto">
          </div>
          <div class="form-group col-8">
            <label for="exampleTextarea" class="form-label mt-4">Descripcion del presupuesto</label>
            <textarea class="form-control" rows="3" formControlName="descripcionPresupuesto"></textarea>
          </div>
          <div class="form-group col-8">
            <label class="col-form-label mt-4" for="inputDefault">Presupuesto</label>
            <input type="text" class="form-control" formControlName="valorPresupuesto">
          </div>
        </div>
        <div class="form-check form-switch mt-4">
          <label class="form-check-label">Reparacion llevada al Taller</label>
          <input class="form-check-input" type="checkbox" formControlName="enTaller">
        </div>
        <div class="form-check form-switch mt-4">
          <label class="form-check-label" >Reparacion Terminada</label>
          <input class="form-check-input" type="checkbox" formControlName="reparacionTerminada">
        </div>
        <div class="form-check form-switch mt-4">
          <label class="form-check-label" >Retiro cliente</label>
          <input class="form-check-input" type="checkbox" formControlName="retiroCliente">
        </div>
      </fieldset>
      <div class="row">
        <button class="btn btn-primary mt-4" type="submit">Guardar Cambios</button>
        <button class="btn btn-danger mt-4" type="button" (click)="cancelar()">Cancelar</button>
      </div>
    </form>
  </div>
</div>